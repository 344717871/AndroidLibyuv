# 常见格式
常见的色彩格式主要分为两类，一类是RGBA系列，一类是YUV系列。
## RGBA系列
首先就是rgba系列的格式，RGBA色彩主要用于色彩的显示和描述。常见的有RGBA/ARGB/BGRA/ABGR/RGB/BGR。这些格式都比较好理解了。R、G、B、A分别表示红绿蓝及透明通道。
以RGBA为例，就是4个字节表示一个颜色值，排列方式就是RGBARGBARGBA这样排列。而RGB，就是三个字节表示一个颜色值，没有透明通道，排列方式就是RGBRGBRGB。在通常的视频中，也是没有透明通道的（也有例外，比如MOV格式，是可以包含透明通道的）。所以当RGBA编码为视频色彩时，A是会被丢掉的。
当然，上面说的，是将每个色彩都用一个字节来表示的情况。RGBA也有RGBA_8888，RGBA_4444,RGB565等等众多格式，也就是并不是每个颜色都用一个字节来表示。以RGB565为例，是用两个字节来表示RGB三个色彩，R占5位，G占6位，B占5位。RGB565与RGB24相比，色彩上稍有损失，一般情况下，不细致对比，不容易发现这个损失，但是内存上会节约1/3的大小。
## YUV系列
YUV主要用于优化彩色视频信号的传输，相比RGBA色彩来说，YUV格式占用更少的内存。YUV系列的格式，与RGBA一样，也是五花八门，常见的有YUY2、YUYV、YVYU、UYVY、AYUV、Y41P、Y411、Y211、IF09、IYUV、YV12、YVU9、YUV411、YUV420、YUV422等等。Y表示亮度，U、V都表示色度。如果只有Y分量，没有UV分量，那么得到的就是黑白灰度图像。
与YUV类似的还有YCrCb，YIQ等色彩格式。YIQ模型与YUV模型类似，用于NTSC制式的电视系统。YIQ颜色空间中的I和Q分量相当于将YUV空间中的UV分量做了一个33度的旋转。而YCrCb是YUV的一种派生色彩，Y包含了绿色色度和亮度，Cr表示红色色度，Cb表示蓝色色度。
我们在实际使用时，遇到最多的大概就是NV21、NV12、YUV420P、YUV420SP、I420等这些格式。他们有什么区别呢？
实际上I420就是标准的YUV420P，以4\*4的图像来说，YUV排列顺序为YYYYYYYYYYYYYYYYUUUUVVVV。YUV大小分别为4\*4、2\*2、2\*2。
NV12为标准的YUV420SP，以4\*4的图像来说，YUV排列顺序为YYYYYYYYYYYYYYYYUVUVUVUV。Y大小分别为4\*4、UV大小为4\*2。
NV21与NV12类似，只是排列顺序上UV换了个边，变为YYYYYYYYYYYYYYYYVUVUVUVU。


# 常用RGB与YUV之间的转换
很多时候，我们在网上找RGB转YUV格式或者YUV转RGB格式的转换公式时，总会得到不一样的公式，让我们无法选择，不知道哪个是正确的。实际上，RGB转YUV或者YUV转RGB的确会有不同的公式。这是由于不同的标准以及转换校正造成的。我们利用RGB转成YUV来传输，然后显示时又需要被还原成RGB。转换参数你可以任意改，转换公式你也可以任意改，但是要保证被还原后的数据色彩能够最大程度被还原。所以，不管白猫黑猫，抓住老鼠就是好猫。恩，也就是黄狸黑狸,得鼠者熊。
根据BT.601标准（SDTV,标清），定义参数如下：
```bash
Wr=0.299
Wb=0.114
Wg=1-Wr-Wb=0.587
Umax=0.436
Vmax=0.615
```
RGB转YUV公式如下：
$Y^`=W_rR+W_gG+W_bB=0.299R+0.587G+0.114B$
$U=U_{max}\frac{B-Y^`}{1-W_b}\approx0.492(B-Y^`)$
$V=V_{max}\frac{R-Y^`}{1-W_r}\approx0.877(R-Y^`)$

反向推导YUV转RGB的，得到公式如下：

$R=Y^`+1.14V$
$G=Y^`-0.395U-0.581V$
$B=Y^`+2.033U$

即得到RGB和YUV根据BT.601标准的公式为：
```bash
#RGB转YUV
#[Y]        [0.299  0.587   0.114   ][R]
#[U]    =   [-0.147 -0.289  0.436   ][G]
#[V]        [0.615  -0.515  -0.100  ][B]
Y = 0.299 R + 0.587 G + 0.114 B
U = -0.147 R - 0.289 G + 0.436 B 
V = 0.615 R - 0.515 G - 0.100 B
#YUV转RGB
#[R]        [1  0       1.140   ][Y]
#[G]    =   [1  -0.395  -0.581  ][U]
#[B]        [1  2.032   0       ][V]
R = Y + 1.402 V
G= Y - 0.395 U - 0.581V
B= Y + 2.032U

# 在老式的非SIMD体系结构中，浮点运算慢与定点运算，所以变换下：
# RGB转YUV，studio-swing，Y的范围为[16-235],UV的范围为[16-240]
Y = ((66R+129G+25B+128)>>8)+16
U = ((-38R-74G+112B+128)>>8)+128
V = ((112R-94G-18B+128)>>8)+128

# RGB转YUV，full-swing，YUV的范围都为[0-255]
Y = (77R+150G+29B+128)>>8
U = (-43R-84G+127B+128)>>8)+128
V = ((127R-106G-21B+128)>>8)+128

# YUV转RGB
C = Y-16
D = U-128
E = V-128
R = clamp((298*C + 409 * E +128)>>8)
G = clamp((298*C - 100* D - 208* E+ 128)>>8)
B = clamp((298*C + 516* D- 128)>>8)

```

RGBA转YUV具体实现，可参考[Android视频编码——RGBA、RGB、BGRA、BGR转YUV420P、YUV420SP](http://blog.csdn.net/junzia/article/details/54707322)

# libyuv的使用
[libyuv源码地址](https://chromium.googlesource.com/libyuv/libyuv/)
libyuv提供了非常方面好用的色彩空间转换、旋转、缩放的功能，转换效率也非常高。如果有色彩空间转换、旋转、缩放等功能的需求，不妨使用此库来完成。

